var i_width_sankey=0;zaza=function(){$("#div_sankey_container").css("width",i_width_sankey+"px");var d=0;var b=0;var c=0;var a=0;$("#div_paths_title").click(function(){if(d%2==0){$("#div_paths_content").css("display","none");$("#div_paths_title").html('<div style="float: left; width: 14px;">+</div><div style="float: left;">PATHS</div>')}else{$("#div_paths_content").css("display","");$("#div_paths_title").html('<div style="float: left; width: 14px;">-</div><div style="float: left;">PATHS</div>')}d++});$("#div_flow_title").click(function(){if(b%2==0){$("#div_flow_content").css("display","none");$("#div_flow_title").html('<div style="float: left; width: 14px;">+</div><div style="float: left;">FLOW</div>')}else{$("#div_flow_content").css("display","");$("#div_flow_title").html('<div style="float: left; width: 14px;">-</div><div style="float: left;">FLOW</div>')}b++});$("#div_statistics_title").click(function(){if(c%2==0){$("#div_statistics_content").css("display","none");$("#div_statistics_title").html('<div style="float: left; width: 14px;">+</div><div style="float: left;">STATISTICS</div>')}else{$("#div_statistics_content").css("display","");$("#div_statistics_title").html('<div style="float: left; width: 14px;">-</div><div style="float: left;">STATISTICS</div>')}c++})};recreateTimeWindowSelect=function(a,e){var f=new Array();f.push("LAST DAY");f.push("LAST WEEK");f.push("LAST MONTH");f.push("LAST YEAR");f.push("ALL");f.push("CUSTOM");var c=new Array();c.push("1 DAY");c.push("1 WEEK");c.push("1 MONTH");c.push("1 YEAR");c.push("ALL");c.push("CUSTOM");if(e=="QUERY"){var b='<select size="1" class="select_normal_nosearch" name="s_time_window" id="s_time_window" onchange="toggleCustomDates();" style="width: 200px; background: #eeeeee; border: solid 1px #333333;">';for(var d=0;d<f.length;d++){if(c[d]==a){b+='<option value="'+c[d]+'" selected>'+f[d]+"</option>"}else{b+='<option value="'+c[d]+'">'+f[d]+"</option>"}}b+="</select>";$("#div_time_window").html(b);$("#s_time_window").select2({minimumResultsForSearch:-1,dropdownAutoWidth:true})}else{if(e=="COMPARE"){var b='<select size="1" class="select_normal_nosearch" name="s_time_window_compare" id="s_time_window" onchange="toggleCustomDatesCompare();" style="width: 200px; background: #eeeeee; border: solid 1px #333333;">';for(var d=0;d<f.length;d++){if(c[d]==a){b+='<option value="'+c[d]+'" selected>'+f[d]+"</option>"}else{b+='<option value="'+c[d]+'">'+f[d]+"</option>"}}b+="</select>";$("#div_time_window_compare").html(s_time_window_compare);$("#s_time_window_compare").select2({minimumResultsForSearch:-1,dropdownAutoWidth:true})}}};toggleCustomDates=function(){var a=$("#s_time_window").val();if(a=="CUSTOM"){$("#div_custom_dates").css("display","");getMinMaxDate(1,"","","QUERY")}else{$("#div_custom_dates").css("display","none")}evaluateControls()};toggleCustomDatesCompare=function(){var a=$("#s_time_window_compare").val();if(a=="CUSTOM"){$("#div_custom_dates_compare").css("display","");getMinMaxDate(1,"","","COMPARE")}else{$("#div_custom_dates_compare").css("display","none")}evaluateControls()};var i_controls_toggle=0;controlsToggle=function(){if(i_controls_toggle%2==0){$("#div_controls_content_all").css("display","none");$("#div_controls_collapse_arrow").html('<img src="images/collapse_down.png" width="10" border="0">');evaluateControls()}else{$("#div_controls_content_all").css("display","");$("#div_controls_collapse_arrow").html('<img src="images/collapse_up.png" width="10" border="0">');evaluateControls()}assignAbsolutes();i_controls_toggle++};toggleRedraw=function(a){if(a=="tree"){if($("#div_tree_filter").css("display")=="none"){$("#div_tree_filter").css("display","")}else{$("#div_tree_filter").css("display","none")}}else{if(a=="sankey"){if($("#div_flow_filter").css("display")=="none"){$("#div_flow_filter").css("display","");$("#slider-range-flow").css("width",(i_width_sankey-618)+"px")}else{$("#div_flow_filter").css("display","none");$("#slider-range-flow").css("width",(i_width_sankey-118)+"px")}}else{if(a=="compare"){if($("#div_compare_filter").css("display")=="none"){$("#div_compare_filter").css("display","");$("#slider-range-compare").css("width",(i_width_sankey-618)+"px")}else{$("#div_compare_filter").css("display","none");$("#slider-range-compare").css("width",(i_width_sankey-118)+"px")}}}}};controlsExpand=function(){$("#div_controls_content_all").css("display","");$("#div_controls_collapse_arrow").html('<img src="images/collapse_up.png" width="10" border="0">');evaluateControls();assignAbsolutes();if(i_controls_toggle%2==1){i_controls_toggle++}};compareToggle=function(a){if(a=="COMPARISON"){$("#div_nav").css("background","#91CBFF");$("#div_eoi_select .select2-selection, #div_eoi_select .select2-selection--single").css("background","#91CBFF");$("#div_controls_title_text").html("Comparison");$("#div_controls_compare").css("display","");$("#div_show_me").css("display","none");$("#div_show_me_compare").css("display","");$("#img_sidebar_glass").attr("src","/tcj/images/sidebar_glass_cccccc_off.png");$("#img_sidebar_compare").attr("src","/tcj/images/sidebar_compare_cccccc_on.png");$("#div_scoring_options").css("display","none")}else{if(a=="CONTROLS"){$("#div_controls_compare").css("display","none");$("#div_nav").css("background","#EC881D");$("#div_eoi_select .select2-selection, #div_eoi_select .select2-selection--single").css("background","#EC881D");$("#div_controls_title_text").html("Controls");$("#div_show_me_compare").css("display","none");$("#div_show_me").css("display","");$("#img_sidebar_compare").attr("src","/tcj/images/sidebar_compare_cccccc_off.png");$("#img_sidebar_glass").attr("src","/tcj/images/sidebar_glass_cccccc_on.png");setResultSet()}}evaluateControls()};var s_direction_set="endevent";getEventValues=function(){if(i_auto==1){callRunTree();b_idle=0}else{if(1==2){blockHistoryRun()}else{blockUpdate()}b_idle=0;var a=$.get("/tcj/aa",{a:"geteventvalues"},function(b){$("#s_event").html(b.dashboard.events);$("#s_event_compare").html(b.dashboard.events);$("[id^='field_']").html(b.dashboard.fields);$.unblockUI();b_idle=1},"json")}};var i_get_min_max_date=0;getMinMaxDate=function(a,e,c,b){if(i_get_min_max_date==0){if(a==1){blockUpdate()}var d=$.get("/tcj/aa",{a:"getminmaxdate"},function(f){if(e==""){e=f.dashboard.mindate}if(c==""){c=f.dashboard.mindateplus}if(b=="COMPARE"){$("#div_dp_loading_compare").css("display","none");$("#div_dp_container_compare").css("display","");$("#dp_start_compare").datepicker({autoHide:true,format:"yyyy-mm-dd",autoPick:true,date:e,startDate:e,endDate:f.dashboard.maxdate});$("#dp_end_compare").datepicker({autoHide:true,format:"yyyy-mm-dd",autoPick:true,date:c,startDate:e,endDate:f.dashboard.maxdate})}else{$("#div_dp_loading").css("display","none");$("#div_dp_container").css("display","");$("#dp_start").datepicker({autoHide:true,format:"yyyy-mm-dd",autoPick:true,date:e,startDate:e,endDate:f.dashboard.maxdate});$("#dp_end").datepicker({autoHide:true,format:"yyyy-mm-dd",autoPick:true,date:c,startDate:e,endDate:f.dashboard.maxdate})}if(a==1){$.unblockUI()}},"json")}};getTstampCode=function(){var a=moment().format("YYYYMMDDHHmmssSSS");return a};getRandomString=function(b){var a="";var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var c=0;c<b;c++){a+=d.charAt(Math.floor(Math.random()*d.length))}return a};var s_controls="";callRunTree=function(){$("#div_tree_container").empty();$("#div_tree_container_compare").empty();b_idle=0;$("#div_paths").css("display","none");$("#div_flow").css("display","none");$("#div_graph").css("display","none");$("#div_sunburst").css("display","none");$("#div_bar").css("display","none");$("#div_target").css("display","none");$("#div_cooccurrence_matrix").html("");$("#div_pie").css("display","none");$("#div_tree_container").html("");$("#div_flow_chart").html("");$("#div_stats_bar").html("");$("#div_data_compare").css("display","none");$("#div_report").css("display","none");$("#div_data_paths").css("display","none");$("#div_syntax").css("display","none");$("#div_paths_compare").css("display","none");$("#div_flow_compare").css("display","none");$("#div_tree_container_compare").html("");$("#div_flow_chart_compare").html("");readyAimFire("","")};callRunTree2=function(){$("#div_tree_container").empty();$("#div_tree_container_compare").empty();blockBackgroundRun();b_idle=0;resetTargetPaths();var h=$("#s_direction").val();s_direction_set=h;var n=$("#s_eoi_setting").val();var p=$("#s_event").val();if(n!="EQUALS"){p=$("#t_event").val()}var T=$("#s_result_set").val();var l=$("#s_scoring_options").val();var C=$("#s_max_events").val();var G=$("#s_time_window").val();var q=$("#dp_start").val();var j=$("#dp_end").val();var e=$("#s_dedupe").val();var l=$("#s_scoring_options").val();var S="";var E=$("#cb_filter").is(":checked");var s=0;if($("#cb_include_eoi").is(":checked")){s=1}var k=$("#cb_first_match").val();var P=0;if($("#cb_drops").is(":checked")){P=1}var I=0;if($("#s_dedupe")!="NONE"&&$("#cb_eoi_dedupe").is(":checked")){I=1}var w=$("#uidfield").val();var o=$("#dataset").val();var D=getTstampCode()+"-"+getRandomString(20);s_controls=JSON.stringify($("#f_controls").serializeArray());var t=0;if($("#div_controls_compare").css("display")!="none"){t=1}var F="";var r=$("#cb_filter_compare").is(":checked");var O=0;if($("#cb_include_eoi_compare").is(":checked")){O=1}var u=$("#s_direction_compare").val();var J=$("#s_eoi_setting_compare").val();var V=$("#s_event_compare").val();if(J!="EQUALS"){V=$("#t_event_compare").val()}var g=$("#s_result_set_compare").val();var i=$("#s_max_events_compare").val();var x=$("#s_time_window_compare").val();var R=$("#dp_start_compare").val();var f=$("#dp_end_compare").val();var m=$("#s_dedupe_compare").val();var z=$("#cb_first_match_compare").val();var c=0;if($("#cb_drops_compare").is(":checked")){c=1}var A=0;if($("#s_dedupe_compare")!="NONE"&&$("#cb_eoi_dedupe_compare").is(":checked")){A=1}var L=JSON.stringify($("#f_controls_compare").serializeArray());if(E){var Q=$("[id^='open_parens_0_'").length;for(var K=0;K<Q;K++){var H=$("#open_parens_0_"+K).val();var a=$("#scope_0_"+K).val();var B=$("#field_0_"+K).val();var b=$("#condition_0_"+K).val();var d=$("#value_0_"+K).val();var v=$("#close_parens_0_"+K).val();var N="";if(K>0){N=" "+$("#and_or_0_"+K).val()}if(a=="ALL RECORDS MATCH"){if(b=="LESS THAN"){S+=N+" "+H+" b."+B+" < '"+d+"' "+v}else{if(b=="LESS THAN OR EQUAL TO"){S+=N+" "+H+" b."+B+" <= '"+d+"' "+v}else{if(b=="GREATER THAN"){S+=N+" "+H+" b."+B+" > '"+d+"' "+v}else{if(b=="GREATER THAN OR EQUAL TO"){S+=N+" "+H+" b."+B+" >= '"+d+"' "+v}else{if(b=="EQUAL TO"){S+=N+" "+H+" b."+B+" = '"+d.replace(/'/g,"''")+"' "+v}else{if(b=="NOT EQUAL TO"){S+=N+" "+H+" b."+B+" <> '"+d.replace(/'/g,"''")+"' "+v}else{if(b=="CONTAINS"){S+=N+" "+H+" LOWER(b."+B+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%' "+v}else{if(b=="DOES NOT CONTAIN"){S+=N+" "+H+" LOWER(b."+B+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%' "+v}else{if(b=="STARTS WITH"){S+=N+" "+H+" LOWER(b."+B+") LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%' "+v}else{if(b=="DOES NOT START WITH"){S+=N+" "+H+" LOWER(b."+B+") NOT LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%' "+v}else{if(b=="ENDS WITH"){S+=N+" "+H+" LOWER(b."+B+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"' "+v}else{if(b=="DOES NOT END WITH"){S+=N+" "+H+" LOWER(b."+B+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"' "+v}else{if(b=="IS EMPTY"){S+=N+" "+H+" b."+B+" = '' "+v}else{if(b=="IS NOT EMPTY"){S+=N+" "+H+" b."+B+" <> '' "+v}}}}}}}}}}}}}}}else{if(a=="CUSTOMER HISTORY INCLUDES"){if(b=="LESS THAN"){S+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" < '"+d+"') "+v}else{if(b=="LESS THAN OR EQUAL TO"){S+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" <= '"+d+"') "+v}else{if(b=="GREATER THAN"){S+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" > '"+d+"') "+v}else{if(b=="GREATER THAN OR EQUAL TO"){S+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" >= '"+d+"') "+v}else{if(b=="EQUAL TO"){S+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") = '"+d.replace(/'/g,"''").toLowerCase()+"') "+v}else{if(b=="NOT EQUAL TO"){S+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") <> '"+d.replace(/'/g,"''").toLowerCase()+"') "+v}else{if(b=="CONTAINS"){S+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%') "+v}else{if(b=="DOES NOT CONTAIN"){S+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%') "+v}else{if(b=="STARTS WITH"){S+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%') "+v}else{if(b=="DOES NOT START WITH"){S+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") NOT LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%') "+v}else{if(b=="ENDS WITH"){S+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"') "+v}else{if(b=="DOES NOT END WITH"){S+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"') "+v}else{if(b=="IS EMPTY"){S+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" = '') "+v}else{if(b=="IS NOT EMPTY"){S+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" <> '') "+v}}}}}}}}}}}}}}}else{if(a=="CUSTOMER HISTORY DOES NOT INCLUDE"){if(b=="LESS THAN"){S+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" < '"+d+"') "+v}else{if(b=="LESS THAN OR EQUAL TO"){S+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" <= '"+d+"') "+v}else{if(b=="GREATER THAN"){S+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" > '"+d+"') "+v}else{if(b=="GREATER THAN OR EQUAL TO"){S+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" >= '"+d+"') "+v}else{if(b=="EQUAL TO"){S+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") = '"+d.replace(/'/g,"''").toLowerCase()+"') "+v}else{if(b=="NOT EQUAL TO"){S+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") <> '"+d.replace(/'/g,"''").toLowerCase()+"') "+v}else{if(b=="CONTAINS"){S+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%') "+v}else{if(b=="DOES NOT CONTAIN"){S+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%') "+v}else{if(b=="STARTS WITH"){S+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%') "+v}else{if(b=="DOES NOT START WITH"){S+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") NOT LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%') "+v}else{if(b=="ENDS WITH"){S+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"') "+v}else{if(b=="DOES NOT END WITH"){S+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"') "+v}else{if(b=="IS EMPTY"){S+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" = '') "+v}else{if(b=="IS NOT EMPTY"){S+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" <> '') "+v}}}}}}}}}}}}}}}}}}}if(r){var Q=$("[id^='open_parens_compare_0_'").length;for(var K=0;K<Q;K++){var H=$("#open_parens_compare_0_"+K).val();var a=$("#scope_compare_0_"+K).val();var B=$("#field_compare_0_"+K).val();var b=$("#condition_compare_0_"+K).val();var d=$("#value_compare_0_"+K).val();var v=$("#close_parens_compare_0_"+K).val();var N="";if(K>0){N=" "+$("#and_or_compare_0_"+K).val()}if(a=="ALL RECORDS MATCH"){if(b=="LESS THAN"){F+=N+" "+H+" b."+B+" < '"+d+"' "+v}else{if(b=="LESS THAN OR EQUAL TO"){F+=N+" "+H+" b."+B+" <= '"+d+"' "+v}else{if(b=="GREATER THAN"){F+=N+" "+H+" b."+B+" > '"+d+"' "+v}else{if(b=="GREATER THAN OR EQUAL TO"){F+=N+" "+H+" b."+B+" >= '"+d+"' "+v}else{if(b=="EQUAL TO"){F+=N+" "+H+" b."+B+" = '"+d.replace(/'/g,"''")+"' "+v}else{if(b=="NOT EQUAL TO"){F+=N+" "+H+" b."+B+" <> '"+d.replace(/'/g,"''")+"' "+v}else{if(b=="CONTAINS"){F+=N+" "+H+" LOWER(b."+B+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%' "+v}else{if(b=="DOES NOT CONTAIN"){F+=N+" "+H+" LOWER(b."+B+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%' "+v}else{if(b=="STARTS WITH"){F+=N+" "+H+" LOWER(b."+B+") LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%' "+v}else{if(b=="DOES NOT START WITH"){F+=N+" "+H+" LOWER(b."+B+") NOT LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%' "+v}else{if(b=="ENDS WITH"){F+=N+" "+H+" LOWER(b."+B+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"' "+v}else{if(b=="DOES NOT END WITH"){F+=N+" "+H+" LOWER(b."+B+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"' "+v}else{if(b=="IS EMPTY"){F+=N+" "+H+" b."+B+" = '' "+v}else{if(b=="IS NOT EMPTY"){F+=N+" "+H+" b."+B+" <> '' "+v}}}}}}}}}}}}}}}else{if(a=="CUSTOMER HISTORY INCLUDES"){if(b=="LESS THAN"){F+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" < '"+d+"') "+v}else{if(b=="LESS THAN OR EQUAL TO"){F+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" <= '"+d+"') "+v}else{if(b=="GREATER THAN"){F+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" > '"+d+"') "+v}else{if(b=="GREATER THAN OR EQUAL TO"){F+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" >= '"+d+"') "+v}else{if(b=="EQUAL TO"){F+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") = '"+d.replace(/'/g,"''").toLowerCase()+"') "+v}else{if(b=="NOT EQUAL TO"){F+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") <> '"+d.replace(/'/g,"''").toLowerCase()+"') "+v}else{if(b=="CONTAINS"){F+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%') "+v}else{if(b=="DOES NOT CONTAIN"){F+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%') "+v}else{if(b=="STARTS WITH"){F+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%') "+v}else{if(b=="DOES NOT START WITH"){F+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") NOT LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%') "+v}else{if(b=="ENDS WITH"){F+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"') "+v}else{if(b=="DOES NOT END WITH"){F+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"') "+v}else{if(b=="IS EMPTY"){F+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" = '') "+v}else{if(b=="IS NOT EMPTY"){F+=N+" "+H+"b."+w+" IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" <> '') "+v}}}}}}}}}}}}}}}else{if(a=="CUSTOMER HISTORY DOES NOT INCLUDE"){if(b=="LESS THAN"){F+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" < '"+d+"') "+v}else{if(b=="LESS THAN OR EQUAL TO"){F+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" <= '"+d+"') "+v}else{if(b=="GREATER THAN"){F+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" > '"+d+"') "+v}else{if(b=="GREATER THAN OR EQUAL TO"){F+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" >= '"+d+"') "+v}else{if(b=="EQUAL TO"){F+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") = '"+d.replace(/'/g,"''").toLowerCase()+"') "+v}else{if(b=="NOT EQUAL TO"){F+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") <> '"+d.replace(/'/g,"''").toLowerCase()+"') "+v}else{if(b=="CONTAINS"){F+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%') "+v}else{if(b=="DOES NOT CONTAIN"){F+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%') "+v}else{if(b=="STARTS WITH"){F+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%') "+v}else{if(b=="DOES NOT START WITH"){F+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") NOT LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%') "+v}else{if(b=="ENDS WITH"){F+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"') "+v}else{if(b=="DOES NOT END WITH"){F+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE LOWER(x."+B+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"') "+v}else{if(b=="IS EMPTY"){F+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" = '') "+v}else{if(b=="IS NOT EMPTY"){F+=N+" "+H+"b."+w+" NOT IN (SELECT x."+w+" FROM "+o+" x WHERE x."+B+" <> '') "+v}}}}}}}}}}}}}}}}}}}$("#div_paths").css("display","none");$("#div_flow").css("display","none");$("#div_graph").css("display","none");$("#div_sunburst").css("display","none");$("#div_bar").css("display","none");$("#div_target").css("display","none");$("#div_cooccurrence_matrix").html("");$("#div_pie").css("display","none");$("#div_tree_container").html("");$("#div_flow_chart").html("");$("#div_stats_bar").html("");$("#div_data_compare").css("display","none");$("#div_report").css("display","none");$("#div_data_paths").css("display","none");$("#div_syntax").css("display","none");$("#div_paths_compare").css("display","none");$("#div_flow_compare").css("display","none");$("#div_tree_container_compare").html("");$("#div_flow_chart_compare").html("");if(h=="endevent"){$("#div_top_second_event").html("Top Second to Last Events");$("#div_data_second_events").html("Top Second to Last Events");$("#span_sunburst_message").html("of paths end with this sequence of events")}else{if(h=="startevent"){$("#div_top_second_event").html("Top Second Events");$("#div_data_second_events").html("Top Second Events");$("#span_sunburst_message").html("of paths begin with this sequence of events")}}if(1==1){var M="GETQUERYRESULTS";var U=$("#h_field_score").val();if(T=="ALL"&&U.trim()!=""&&l!="NONE"){M="GETQUERYRESULTSWITHSCORE"}readyAimFire("","")}else{if(t==1){s_url_data="/tcj/aa?a=GETQUERYCOMPARERESULTS&e="+encodeURIComponent(p)+"&seoi="+n+"&d="+h+"&rs="+T+"&me="+C+"&tw="+G+"&cds="+q+"&cde="+j+"&dd="+e+"&f="+encodeURIComponent(S)+"&feoi="+s+"&fm="+k+"&ad="+P+"&eoid="+I+"&tstampcode="+D+"&controls="+encodeURIComponent(s_controls)+"&ec="+encodeURIComponent(V)+"&seoic="+J+"&dc="+u+"&rsc="+g+"&mec="+i+"&twc="+x+"&cdsc="+R+"&cdec="+f+"&ddc="+m+"&fmc="+z+"&adc="+c+"&eoidc="+A+"&fc="+encodeURIComponent(F)+"&feoic="+O+"&controlsc="+encodeURIComponent(L);readyAimFireCompare(s_url_data,h)}}if(i_auto==1){s_url_data="latest.json"}};var a_target_paths=[];var a_target_id_paths=[];addToTargetPaths=function(c,b){var a=0;a_target_id_paths.push(b);var d=JSON.parse("["+b+"]");if($.inArray(root.id,d)!=-1){a++}c=c.replace(/'/g,"''");if(a>0){if(s_direction_set=="startevent"){var e=c.split(", ");e=e.reverse();c=e.toString().replace(/,/g,", ");if(jQuery.inArray(c,a_target_paths)<0){a_target_paths.push("'["+c+"%'^")}}else{if(s_direction_set=="endevent"){var c="'%"+c+"]'^";if(jQuery.inArray(c,a_target_paths)<0){a_target_paths.push(c)}}}}else{var c="'%"+c+"%'^";if(jQuery.inArray(c,a_target_paths)<0){a_target_paths.push(c)}}$("#div_btn_create_target_list").css("display","");$("#div_btn_drill_down_report").css("display","");$("#div_btn_reset_target_paths").css("display","");if(a_target_paths.length==1&&a>0){$("#div_btn_view_text").css("display","")}else{$("#div_btn_view_text").css("display","none")}if(a>0){$("#div_btn_drill_down_report").css("display","")}else{$("#div_btn_drill_down_report").css("display","none")}};viewTargetPaths=function(){alert(a_target_paths.toString());alert(a_target_id_paths.toString())};resetTargetPaths=function(){$("#div_btn_create_target_list").css("display","none");$("#div_btn_drill_down_report").css("display","none");$("#div_btn_view_text").css("display","none");$("#div_btn_reset_target_paths").css("display","none");clearColorEdgePath();a_target_paths=[];a_target_id_paths=[]};redrawTargetPaths=function(){clearColorEdgePath();reColorEdgePaths("#EC881D")};getTargetListSelect=function(){blockBackgroundTargetSelectRun()};getTargetList=function(D){var F=0;var v=0;for(var M=0;M<a_target_id_paths.length;M++){var r=JSON.parse("["+a_target_id_paths[M]+"]");if($.inArray(root.id,r)!=-1){F++}else{v++}}if(i_background_target_run==1){alert("Only one target list, report or text records request can be run at a time.");return false}var C='<img src="/tcj/images/spinner2.png" class="loading" style="width: 128px; height: 128px;"><br><br><input type="button" value="RUN IN BACKGROUND" style="width: 160px; height: 20px; font-weight: 500; background: #eeeeee; border: solid 1px #333333; cursor: pointer;" onclick="setBackgroundTargetRun();"><br><br>';$("#div_display_box_target_background").html(C);$("#div_sidebar_target").css("background","#333333");C='<div style="float: left; text-align: center; width: 100%; font-size: 14px; font-weight: 500; font-style: italic;"><img src="/tcj/images/spinner2.png" class="loading" style="width: 128px; height: 128px;"><br><br><br>Building Target List. Please Wait.<br><br></div>';$("#div_target_list").html(C);blockBackgroundTargetRun();b_idle=0;var f=$("#s_direction").val();var j=$("#s_eoi_setting").val();var l=$("#s_event").val();if(j!="EQUALS"){l=$("#t_event").val()}var O=$("#s_result_set").val();var u=$("#s_max_events").val();var z=$("#s_time_window").val();var m=$("#dp_start").val();var g=$("#dp_end").val();var c=$("#s_dedupe").val();var E=a_target_paths.toString().substring(0,a_target_paths.toString().length-1);s_controls=JSON.stringify($("#f_controls").serializeArray());var w=getTstampCode()+"-"+getRandomString(20);var K="";var x=$("#cb_filter").is(":checked");var o=0;if($("#cb_include_eoi").is(":checked")){o=1}var h=$("#cb_first_match").val();var I=0;if($("#cb_drops").is(":checked")){I=1}var B=0;if($("#s_dedupe")!="NONE"&&$("#cb_eoi_dedupe").is(":checked")){B=1}var s=$("#uidfield").val();var N=$("#eventfield").val();var k=$("#dataset").val();var J=0;if(x){J=$("[id^='open_parens_0_'").length;for(var G=0;G<J;G++){var A=$("#open_parens_0_"+G).val();var a=$("#scope_0_"+G).val();var t=$("#field_0_"+G).val();var b=$("#condition_0_"+G).val();var d=$("#value_0_"+G).val();var q=$("#close_parens_0_"+G).val();var H="";if(G>0){H=$("#and_or_0_"+G).val()}if(a=="ALL RECORDS MATCH"){if(b=="LESS THAN"){K+=H+" "+A+" b."+t+" < '"+d+"' "+q}else{if(b=="LESS THAN OR EQUAL TO"){K+=H+" "+A+" b."+t+" <= '"+d+"' "+q}else{if(b=="GREATER THAN"){K+=H+" "+A+" b."+t+" > '"+d+"' "+q}else{if(b=="GREATER THAN OR EQUAL TO"){K+=H+" "+A+" b."+t+" >= '"+d+"' "+q}else{if(b=="EQUAL TO"){K+=H+" "+A+" b."+t+" = '"+d.replace(/'/g,"''")+"' "+q}else{if(b=="NOT EQUAL TO"){K+=H+" "+A+" b."+t+" <> '"+d.replace(/'/g,"''")+"' "+q}else{if(b=="CONTAINS"){K+=H+" "+A+" LOWER(b."+t+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%' "+q}else{if(b=="DOES NOT CONTAIN"){K+=H+" "+A+" LOWER(b."+t+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%' "+q}else{if(b=="STARTS WITH"){K+=H+" "+A+" LOWER(b."+t+") LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%' "+q}else{if(b=="DOES NOT START WITH"){K+=H+" "+A+" LOWER(b."+t+") NOT LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%' "+q}else{if(b=="ENDS WITH"){K+=H+" "+A+" LOWER(b."+t+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"' "+q}else{if(b=="DOES NOT END WITH"){K+=H+" "+A+" LOWER(b."+t+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"' "+q}else{if(b=="IS EMPTY"){K+=H+" "+A+" b."+t+" = '' "+q}else{if(b=="IS NOT EMPTY"){K+=H+" "+A+" b."+t+" <> '' "+q}}}}}}}}}}}}}}}else{if(a=="CUSTOMER HISTORY INCLUDES"){if(b=="LESS THAN"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" < '"+d+"') "+q}else{if(b=="LESS THAN OR EQUAL TO"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" <= '"+d+"') "+q}else{if(b=="GREATER THAN"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" > '"+d+"') "+q}else{if(b=="GREATER THAN OR EQUAL TO"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" >= '"+d+"') "+q}else{if(b=="EQUAL TO"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") = '"+d.replace(/'/g,"''").toLowerCase()+"') "+q}else{if(b=="NOT EQUAL TO"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") <> '"+d.replace(/'/g,"''").toLowerCase()+"') "+q}else{if(b=="CONTAINS"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%') "+q}else{if(b=="DOES NOT CONTAIN"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%') "+q}else{if(b=="STARTS WITH"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%') "+q}else{if(b=="DOES NOT START WITH"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") NOT LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%') "+q}else{if(b=="ENDS WITH"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"') "+q}else{if(b=="DOES NOT END WITH"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"') "+q}else{if(b=="IS EMPTY"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" = '') "+q}else{if(b=="IS NOT EMPTY"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" <> '') "+q}}}}}}}}}}}}}}}else{if(a=="CUSTOMER HISTORY DOES NOT INCLUDE"){if(b=="LESS THAN"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" < '"+d+"') "+q}else{if(b=="LESS THAN OR EQUAL TO"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" <= '"+d+"') "+q}else{if(b=="GREATER THAN"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" > '"+d+"') "+q}else{if(b=="GREATER THAN OR EQUAL TO"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" >= '"+d+"') "+q}else{if(b=="EQUAL TO"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") = '"+d.replace(/'/g,"''").toLowerCase()+"') "+q}else{if(b=="NOT EQUAL TO"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") <> '"+d.replace(/'/g,"''").toLowerCase()+"') "+q}else{if(b=="CONTAINS"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%') "+q}else{if(b=="DOES NOT CONTAIN"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%') "+q}else{if(b=="STARTS WITH"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%') "+q}else{if(b=="DOES NOT START WITH"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") NOT LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%') "+q}else{if(b=="ENDS WITH"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"') "+q}else{if(b=="DOES NOT END WITH"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"') "+q}else{if(b=="IS EMPTY"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" = '') "+q}else{if(b=="IS NOT EMPTY"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" <> '') "+q}}}}}}}}}}}}}}}}}}}var p="GETTARGETLIST";var L=0;if(F==0&&$("#cb_no_history").is(":checked")&&f=="endevent"){if(J>0){K+="AND "}K+="(b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE x."+N+" = '"+root.name+"') )";p="GETTARGETLISTNOHISTORY";L=1}else{if(F>0&&v>0){p="GETTARGETLISTNOHISTORY"}}var e="TARGET LIST";var n=$.get("/tcj/aa",{a:p,e:l,seoi:j,d:f,me:u,pm:E,tw:z,dd:c,f:K,feoi:o,fm:h,ad:I,eoid:B,tstampcode:w,controls:s_controls,cp:D,cds:m,cde:g,nh:L,ht:e},function(i){if(i.length>0){if(i.trim()=='{"session": "false"}'){window.location="/tcj?e=2";return}$("#div_target_content").html(i);$("#div_target").css("display","");$("#div_target").css("width",i_workspace_width+"px");if(i_background_target_run==0){showSidebar("target");refreshTableSorter();$.unblockUI()}else{i_background_target_run=1;$("#div_sidebar_target").html('<img src="/tcj/images/sidebar_target_cccccc.png" width="30">');$("#div_sidebar_target").css({background:"#EC881D"});i_background_target_run=0}b_idle=1}},"html")};getReportSelect=function(){getReport("CURRENT")};getReport=function(D){var F=0;var v=0;for(var M=0;M<a_target_id_paths.length;M++){var r=JSON.parse("["+a_target_id_paths[M]+"]");if($.inArray(root.id,r)!=-1){F++}else{v++}}if(i_background_target_run==1){alert("Only one target list, report or text records request can be run at a time.");return false}var C='<img src="/tcj/images/spinner2.png" class="loading" style="width: 128px; height: 128px;"><br><br><input type="button" value="RUN IN BACKGROUND" style="width: 160px; height: 20px; font-weight: 500; background: #eeeeee; border: solid 1px #333333; cursor: pointer;" onclick="setBackgroundReportRun();"><br><br>';$("#div_display_box_report_background").html(C);$("#div_sidebar_report").css("background","#333333");C='<div style="float: left; text-align: center; width: 100%; font-size: 14px; font-weight: 500; font-style: italic;"><br><br><img src="/tcj/images/spinner2.png" class="loading" style="width: 128px; height: 128px;"><br><br><br>Building Report. Please Wait.<br><br></div>';$("#div_report_content_placeholder").html(C);blockBackgroundReportRun();b_idle=0;var f=$("#s_direction").val();var j=$("#s_eoi_setting").val();var l=$("#s_event").val();if(j!="EQUALS"){l=$("#t_event").val()}var O=$("#s_result_set").val();var u=$("#s_max_events").val();var z=$("#s_time_window").val();var m=$("#dp_start").val();var g=$("#dp_end").val();var c=$("#s_dedupe").val();var E=a_target_paths.toString().substring(0,a_target_paths.toString().length-1);s_controls=JSON.stringify($("#f_controls").serializeArray());var w=getTstampCode()+"-"+getRandomString(20);var K="";var x=$("#cb_filter").is(":checked");var o=0;if($("#cb_include_eoi").is(":checked")){o=1}var h=$("#cb_first_match").val();var I=0;if($("#cb_drops").is(":checked")){I=1}var B=0;if($("#s_dedupe")!="NONE"&&$("#cb_eoi_dedupe").is(":checked")){B=1}var s=$("#uidfield").val();var N=$("#eventfield").val();var k=$("#dataset").val();var J=0;if(x){J=$("[id^='open_parens_0_'").length;for(var G=0;G<J;G++){var A=$("#open_parens_0_"+G).val();var a=$("#scope_0_"+G).val();var t=$("#field_0_"+G).val();var b=$("#condition_0_"+G).val();var d=$("#value_0_"+G).val();var q=$("#close_parens_0_"+G).val();var H="";if(G>0){H=$("#and_or_0_"+G).val()}if(a=="ALL RECORDS MATCH"){if(b=="LESS THAN"){K+=H+" "+A+" b."+t+" < '"+d+"' "+q}else{if(b=="LESS THAN OR EQUAL TO"){K+=H+" "+A+" b."+t+" <= '"+d+"' "+q}else{if(b=="GREATER THAN"){K+=H+" "+A+" b."+t+" > '"+d+"' "+q}else{if(b=="GREATER THAN OR EQUAL TO"){K+=H+" "+A+" b."+t+" >= '"+d+"' "+q}else{if(b=="EQUAL TO"){K+=H+" "+A+" b."+t+" = '"+d.replace(/'/g,"''")+"' "+q}else{if(b=="NOT EQUAL TO"){K+=H+" "+A+" b."+t+" <> '"+d.replace(/'/g,"''")+"' "+q}else{if(b=="CONTAINS"){K+=H+" "+A+" LOWER(b."+t+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%' "+q}else{if(b=="DOES NOT CONTAIN"){K+=H+" "+A+" LOWER(b."+t+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%' "+q}else{if(b=="STARTS WITH"){K+=H+" "+A+" LOWER(b."+t+") LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%' "+q}else{if(b=="DOES NOT START WITH"){K+=H+" "+A+" LOWER(b."+t+") NOT LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%' "+q}else{if(b=="ENDS WITH"){K+=H+" "+A+" LOWER(b."+t+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"' "+q}else{if(b=="DOES NOT END WITH"){K+=H+" "+A+" LOWER(b."+t+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"' "+q}else{if(b=="IS EMPTY"){K+=H+" "+A+" b."+t+" = '' "+q}else{if(b=="IS NOT EMPTY"){K+=H+" "+A+" b."+t+" <> '' "+q}}}}}}}}}}}}}}}else{if(a=="CUSTOMER HISTORY INCLUDES"){if(b=="LESS THAN"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" < '"+d+"') "+q}else{if(b=="LESS THAN OR EQUAL TO"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" <= '"+d+"') "+q}else{if(b=="GREATER THAN"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" > '"+d+"') "+q}else{if(b=="GREATER THAN OR EQUAL TO"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" >= '"+d+"') "+q}else{if(b=="EQUAL TO"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") = '"+d.replace(/'/g,"''").toLowerCase()+"') "+q}else{if(b=="NOT EQUAL TO"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") <> '"+d.replace(/'/g,"''").toLowerCase()+"') "+q}else{if(b=="CONTAINS"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%') "+q}else{if(b=="DOES NOT CONTAIN"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%') "+q}else{if(b=="STARTS WITH"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%') "+q}else{if(b=="DOES NOT START WITH"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") NOT LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%') "+q}else{if(b=="ENDS WITH"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"') "+q}else{if(b=="DOES NOT END WITH"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"') "+q}else{if(b=="IS EMPTY"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" = '') "+q}else{if(b=="IS NOT EMPTY"){K+=H+" "+A+"b."+s+" IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" <> '') "+q}}}}}}}}}}}}}}}else{if(a=="CUSTOMER HISTORY DOES NOT INCLUDE"){if(b=="LESS THAN"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" < '"+d+"') "+q}else{if(b=="LESS THAN OR EQUAL TO"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" <= '"+d+"') "+q}else{if(b=="GREATER THAN"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" > '"+d+"') "+q}else{if(b=="GREATER THAN OR EQUAL TO"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" >= '"+d+"') "+q}else{if(b=="EQUAL TO"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") = '"+d.replace(/'/g,"''").toLowerCase()+"') "+q}else{if(b=="NOT EQUAL TO"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") <> '"+d.replace(/'/g,"''").toLowerCase()+"') "+q}else{if(b=="CONTAINS"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%') "+q}else{if(b=="DOES NOT CONTAIN"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"%') "+q}else{if(b=="STARTS WITH"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%') "+q}else{if(b=="DOES NOT START WITH"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") NOT LIKE '"+d.replace(/'/g,"''").toLowerCase()+"%') "+q}else{if(b=="ENDS WITH"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"') "+q}else{if(b=="DOES NOT END WITH"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE LOWER(x."+t+") NOT LIKE '%"+d.replace(/'/g,"''").toLowerCase()+"') "+q}else{if(b=="IS EMPTY"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" = '') "+q}else{if(b=="IS NOT EMPTY"){K+=H+" "+A+"b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE x."+t+" <> '') "+q}}}}}}}}}}}}}}}}}}}var p="GETREPORT";var e="REPORT";var L=0;if(F==0&&$("#cb_no_history").is(":checked")){if(J>0){K+="AND "}K+="(b."+s+" NOT IN (SELECT x."+s+" FROM "+k+" x WHERE x."+N+" = '"+root.name+"') )";p="GETREPORTNOHISTORY";L=1}else{if(F>0&&v>0){p="GETREPORTNOHISTORY"}}var n=$.get("/tcj/bb",{a:p,e:l,seoi:j,d:f,me:u,pm:E,tw:z,dd:c,f:K,feoi:o,fm:h,ad:I,eoid:B,tstampcode:w,controls:s_controls,cp:D,cds:m,cde:g,nh:L,ht:e},function(R){if(R.length>0){if(R.trim()=='{"session": "false"}'){window.location="/tcj?e=2";return}$("#div_report_content_placeholder").css("display","none");$("#div_report_content_canvases").css("display","");$("#div_report").css("width",i_workspace_width+"px");x_history_report=R;var S=JSON.parse(x_history_report);$("#s_report_field").html("");if(i_background_target_run==0){showSidebar("report");var Q=S.reportfields.length;for(var P=0;P<Q;P++){if(S.reportfields[P].indexOf("p_0_0_")==0){var y=$("<option/>");var i=S.reportfields[P].replace(/^p_\d+_\d+_/g,"");y.text(i);y.attr("value",S.reportfields[P]);$("#s_report_field").append(y)}}drawReportVisuals(S,0);refreshTableSorter();$.unblockUI()}else{i_background_target_run=1;var Q=S.reportfields.length;for(var P=0;P<Q;P++){if(S.reportfields[P].indexOf("p_0_0_")==0){var y=$("<option/>");var i=S.reportfields[P].replace(/^p_\d+_\d+_/g,"");y.text(i);y.attr("value",S.reportfields[P]);$("#s_report_field").append(y)}}drawReportVisuals(S,0);$("#div_sidebar_report").html('<img src="/tcj/images/sidebar_dashboard_cccccc.png" width="30">');$("#div_sidebar_report").css({background:"#EC881D"});i_background_target_run=0}b_idle=1}},"text")};getTextRecords=function(D){if(i_background_target_run==1){alert("Only one target list, report or text records request can be run at a time.");return false}var p='<img src="/tcj/images/spinner2.png" class="loading" style="width: 128px; height: 128px;"><br><br><input type="button" value="RUN IN BACKGROUND" style="width: 160px; height: 20px; font-weight: 500; background: #eeeeee; border: solid 1px #333333; cursor: pointer;" onclick="setBackgroundTargetRun();"><br><br>';$("#div_display_box_target_background").html(p);$("#div_sidebar_target").css("background","#333333");p='<div style="float: left; text-align: center; width: 100%; font-size: 14px; font-weight: 500; font-style: italic;"><img src="/tcj/images/spinner2.png" class="loading" style="width: 128px; height: 128px;"><br><br><br>Grabbing Text Records. Please Wait.<br><br></div>';$("#div_text_records").html(p);blockBackgroundRun();b_idle=0;var B=$("#s_direction").val();var e=$("#s_eoi_setting").val();var o=$("#s_event").val();if(e!="EQUALS"){o=$("#t_event").val()}var t=$("#s_result_set").val();var v=$("#s_max_events").val();var b=$("#s_time_window").val();var m=$("#dp_start").val();var n=$("#dp_end").val();var E=$("#s_dedupe").val();var A=a_target_paths.toString().substring(0,a_target_paths.toString().length-1);s_controls=JSON.stringify($("#f_controls").serializeArray());var q=getTstampCode()+"-"+getRandomString(20);var f="";var g=$("#cb_filter").is(":checked");var C=0;if($("#cb_include_eoi").is(":checked")){C=1}var h=$("#cb_first_match").val();var r=0;if($("#cb_drops").is(":checked")){r=1}var a=0;if($("#s_dedupe")!="NONE"&&$("#cb_eoi_dedupe").is(":checked")){a=1}var F=$("#uidfield").val();var c=$("#dataset").val();if(g){var w=$("[id^='open_parens_0_'").length;for(var l=0;l<w;l++){var d=$("#open_parens_0_"+l).val();var z=$("#scope_0_"+l).val();var x=$("#field_0_"+l).val();var u=$("#condition_0_"+l).val();var k=$("#value_0_"+l).val();var i=$("#close_parens_0_"+l).val();var j="";if(l>0){j=$("#and_or_0_"+l).val()}if(z=="ALL RECORDS MATCH"){if(u=="LESS THAN"){f+=j+" "+d+" b."+x+" < '"+k+"' "+i}else{if(u=="LESS THAN OR EQUAL TO"){f+=j+" "+d+" b."+x+" <= '"+k+"' "+i}else{if(u=="GREATER THAN"){f+=j+" "+d+" b."+x+" > '"+k+"' "+i}else{if(u=="GREATER THAN OR EQUAL TO"){f+=j+" "+d+" b."+x+" >= '"+k+"' "+i}else{if(u=="EQUAL TO"){f+=j+" "+d+" b."+x+" = '"+k.replace(/'/g,"''")+"' "+i}else{if(u=="NOT EQUAL TO"){f+=j+" "+d+" b."+x+" <> '"+k.replace(/'/g,"''")+"' "+i}else{if(u=="CONTAINS"){f+=j+" "+d+" LOWER(b."+x+") LIKE '%"+k.replace(/'/g,"''").toLowerCase()+"%' "+i}else{if(u=="DOES NOT CONTAIN"){f+=j+" "+d+" LOWER(b."+x+") NOT LIKE '%"+k.replace(/'/g,"''").toLowerCase()+"%' "+i}else{if(u=="STARTS WITH"){f+=j+" "+d+" LOWER(b."+x+") LIKE '"+k.replace(/'/g,"''").toLowerCase()+"%' "+i}else{if(u=="DOES NOT START WITH"){f+=j+" "+d+" LOWER(b."+x+") NOT LIKE '"+k.replace(/'/g,"''").toLowerCase()+"%' "+i}else{if(u=="ENDS WITH"){f+=j+" "+d+" LOWER(b."+x+") LIKE '%"+k.replace(/'/g,"''").toLowerCase()+"' "+i}else{if(u=="DOES NOT END WITH"){f+=j+" "+d+" LOWER(b."+x+") NOT LIKE '%"+k.replace(/'/g,"''").toLowerCase()+"' "+i}else{if(u=="IS EMPTY"){f+=j+" "+d+" b."+x+" = '' "+i}else{if(u=="IS NOT EMPTY"){f+=j+" "+d+" b."+x+" <> '' "+i}}}}}}}}}}}}}}}else{if(z=="CUSTOMER HISTORY INCLUDES"){if(u=="LESS THAN"){f+=j+" "+d+"b."+F+" IN (SELECT x."+F+" FROM "+c+" x WHERE x."+x+" < '"+k+"') "+i}else{if(u=="LESS THAN OR EQUAL TO"){f+=j+" "+d+"b."+F+" IN (SELECT x."+F+" FROM "+c+" x WHERE x."+x+" <= '"+k+"') "+i}else{if(u=="GREATER THAN"){f+=j+" "+d+"b."+F+" IN (SELECT x."+F+" FROM "+c+" x WHERE x."+x+" > '"+k+"') "+i}else{if(u=="GREATER THAN OR EQUAL TO"){f+=j+" "+d+"b."+F+" IN (SELECT x."+F+" FROM "+c+" x WHERE x."+x+" >= '"+k+"') "+i}else{if(u=="EQUAL TO"){f+=j+" "+d+"b."+F+" IN (SELECT x."+F+" FROM "+c+" x WHERE LOWER(x."+x+") = '"+k.replace(/'/g,"''").toLowerCase()+"') "+i}else{if(u=="NOT EQUAL TO"){f+=j+" "+d+"b."+F+" IN (SELECT x."+F+" FROM "+c+" x WHERE LOWER(x."+x+") <> '"+k.replace(/'/g,"''").toLowerCase()+"') "+i}else{if(u=="CONTAINS"){f+=j+" "+d+"b."+F+" IN (SELECT x."+F+" FROM "+c+" x WHERE LOWER(x."+x+") LIKE '%"+k.replace(/'/g,"''").toLowerCase()+"%') "+i}else{if(u=="DOES NOT CONTAIN"){f+=j+" "+d+"b."+F+" IN (SELECT x."+F+" FROM "+c+" x WHERE LOWER(x."+x+") NOT LIKE '%"+k.replace(/'/g,"''").toLowerCase()+"%') "+i}else{if(u=="STARTS WITH"){f+=j+" "+d+"b."+F+" IN (SELECT x."+F+" FROM "+c+" x WHERE LOWER(x."+x+") LIKE '"+k.replace(/'/g,"''").toLowerCase()+"%') "+i}else{if(u=="DOES NOT START WITH"){f+=j+" "+d+"b."+F+" IN (SELECT x."+F+" FROM "+c+" x WHERE LOWER(x."+x+") NOT LIKE '"+k.replace(/'/g,"''").toLowerCase()+"%') "+i}else{if(u=="ENDS WITH"){f+=j+" "+d+"b."+F+" IN (SELECT x."+F+" FROM "+c+" x WHERE LOWER(x."+x+") LIKE '%"+k.replace(/'/g,"''").toLowerCase()+"') "+i}else{if(u=="DOES NOT END WITH"){f+=j+" "+d+"b."+F+" IN (SELECT x."+F+" FROM "+c+" x WHERE LOWER(x."+x+") NOT LIKE '%"+k.replace(/'/g,"''").toLowerCase()+"') "+i}else{if(u=="IS EMPTY"){f+=j+" "+d+"b."+F+" IN (SELECT x."+F+" FROM "+c+" x WHERE x."+x+" = '') "+i}else{if(u=="IS NOT EMPTY"){f+=j+" "+d+"b."+F+" IN (SELECT x."+F+" FROM "+c+" x WHERE x."+x+" <> '') "+i}}}}}}}}}}}}}}}else{if(z=="CUSTOMER HISTORY DOES NOT INCLUDE"){if(u=="LESS THAN"){f+=j+" "+d+"b."+F+" NOT IN (SELECT x."+F+" FROM "+c+" x WHERE x."+x+" < '"+k+"') "+i}else{if(u=="LESS THAN OR EQUAL TO"){f+=j+" "+d+"b."+F+" NOT IN (SELECT x."+F+" FROM "+c+" x WHERE x."+x+" <= '"+k+"') "+i}else{if(u=="GREATER THAN"){f+=j+" "+d+"b."+F+" NOT IN (SELECT x."+F+" FROM "+c+" x WHERE x."+x+" > '"+k+"') "+i}else{if(u=="GREATER THAN OR EQUAL TO"){f+=j+" "+d+"b."+F+" NOT IN (SELECT x."+F+" FROM "+c+" x WHERE x."+x+" >= '"+k+"') "+i}else{if(u=="EQUAL TO"){f+=j+" "+d+"b."+F+" NOT IN (SELECT x."+F+" FROM "+c+" x WHERE LOWER(x."+x+") = '"+k.replace(/'/g,"''").toLowerCase()+"') "+i}else{if(u=="NOT EQUAL TO"){f+=j+" "+d+"b."+F+" NOT IN (SELECT x."+F+" FROM "+c+" x WHERE LOWER(x."+x+") <> '"+k.replace(/'/g,"''").toLowerCase()+"') "+i}else{if(u=="CONTAINS"){f+=j+" "+d+"b."+F+" NOT IN (SELECT x."+F+" FROM "+c+" x WHERE LOWER(x."+x+") LIKE '%"+k.replace(/'/g,"''").toLowerCase()+"%') "+i}else{if(u=="DOES NOT CONTAIN"){f+=j+" "+d+"b."+F+" NOT IN (SELECT x."+F+" FROM "+c+" x WHERE LOWER(x."+x+") NOT LIKE '%"+k.replace(/'/g,"''").toLowerCase()+"%') "+i}else{if(u=="STARTS WITH"){f+=j+" "+d+"b."+F+" NOT IN (SELECT x."+F+" FROM "+c+" x WHERE LOWER(x."+x+") LIKE '"+k.replace(/'/g,"''").toLowerCase()+"%') "+i}else{if(u=="DOES NOT START WITH"){f+=j+" "+d+"b."+F+" NOT IN (SELECT x."+F+" FROM "+c+" x WHERE LOWER(x."+x+") NOT LIKE '"+k.replace(/'/g,"''").toLowerCase()+"%') "+i}else{if(u=="ENDS WITH"){f+=j+" "+d+"b."+F+" NOT IN (SELECT x."+F+" FROM "+c+" x WHERE LOWER(x."+x+") LIKE '%"+k.replace(/'/g,"''").toLowerCase()+"') "+i}else{if(u=="DOES NOT END WITH"){f+=j+" "+d+"b."+F+" NOT IN (SELECT x."+F+" FROM "+c+" x WHERE LOWER(x."+x+") NOT LIKE '%"+k.replace(/'/g,"''").toLowerCase()+"') "+i}else{if(u=="IS EMPTY"){f+=j+" "+d+"b."+F+" NOT IN (SELECT x."+F+" FROM "+c+" x WHERE x."+x+" = '') "+i}else{if(u=="IS NOT EMPTY"){f+=j+" "+d+"b."+F+" NOT IN (SELECT x."+F+" FROM "+c+" x WHERE x."+x+" <> '') "+i}}}}}}}}}}}}}}}}}}}var s=$.get("/tcj/aa",{a:"GETTEXTRECORDS",e:o,seoi:e,d:B,me:v,pm:A,tw:b,dd:E,f:f,feoi:C,fm:h,ad:r,eoid:a,tstampcode:q,controls:s_controls,cp:D,cds:m,cde:n},function(y){if(y.length>0){if(y.trim()=='{"session": "false"}'){window.location="/tcj?e=2";return}$("#div_text_content").html(y);$("#div_text").css("display","");$("#div_text").css("width",i_workspace_width+"px");if(i_background_target_run==0){showSidebar("text");refreshTableSorter();$.unblockUI()}else{i_background_target_run=1;$("#div_sidebar_text").html('<img src="/tcj/images/sidebar_text_cccccc.png" width="30">');$("#div_sidebar_text").css({background:"#EC881D"});i_background_target_run=0}b_idle=1}},"html")};var interval_download_check;downloadSpinner=function(a){blockUpdate();interval_download_check=setInterval(function(){downloadCheck(a)},1000)};downloadCheck=function(a){var b=$.get("/tcj/aa",{a:"DOWNLOADSTATUSCHECK",id:a},function(c){if(c.length>0){if(c==1){$.unblockUI();clearInterval(interval_download_check)}}},"html")};downloadData=function(d){blockUpdate();var a=getRandomString(20);interval_download_check=setInterval(function(){downloadCheck(a)},1000);var c="";if($("#"+d).length>0){c=$("#"+d+" tbody").html()}var b=$("<form>",{action:"/tcj/aa",method:"post"});$("<input>").attr({type:"hidden",name:"a",value:"DOWNLOADDATA"}).appendTo(b);$("<input>").attr({type:"hidden",name:"id",value:a}).appendTo(b);$("<input>").attr({type:"hidden",name:"dt",value:"path"}).appendTo(b);$("<input>").attr({type:"hidden",name:"hc",value:c}).appendTo(b);b.appendTo("body").submit()};evaluateControls=function(){var a=parseInt($("#div_nav").height());$("#div_top_block").css("height",(a+0)+"px")};alterForm=function(){var a=$("#s_direction").val();if(a=="startevent"||a=="endevent"){$("#s_max_events").html('<option value="3">3</option><option value="4">4</option><option value="5">5</option>')}else{if(a="throughevent"){$("#s_max_events").html('<option value="3">3</option><option value="5">5</option>')}}};toggleEOIDedupe=function(){var b=$("#s_dedupe").val();var a=$("#s_direction").val();if(b=="ALL"){if(a=="endevent"&&$("#cb_first_match").is(":checked")){$("#div_eoi_dedupe").css("display","none")}else{$("#div_eoi_dedupe").css("display","")}}else{$("#div_eoi_dedupe").css("display","none")}};